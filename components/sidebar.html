<!DOCTYPE html>
<html>
<head>
    <title>Sidebar</title>
    <link rel="stylesheet" href="/styles/sidebar.css">
</head>
<body>
    <div id="sidebar-container" class="sidebar">
        <button id="dark-mode-toggle">Dark</button>
        <input type="text" id="sidebar-search" placeholder="Search...">
        <nav id="sidebar-nav"></nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const nav = document.getElementById('sidebar-nav');
            
            function createMenuItem(item) {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = item.url;
                a.textContent = item.title;
                li.appendChild(a);
                return li;
            }

            function createCategory(title, items, isSubcategory = false) {
                const section = document.createElement('div');
                section.className = isSubcategory ? 'subcategory collapsed' : 'category collapsed'; // Add collapsed by default
                
                const header = document.createElement('div');
                header.className = 'category-header';
                header.textContent = title;
                
                const content = document.createElement('ul');
                content.className = 'menu-items';
                
                header.addEventListener('click', () => {
                    section.classList.toggle('collapsed');
                });

                section.appendChild(header);
                section.appendChild(content);
                
                if (Array.isArray(items)) {
                    items.forEach(item => {
                        content.appendChild(createMenuItem(item));
                    });
                } else {
                    Object.entries(items).forEach(([subTitle, subItems]) => {
                        content.appendChild(createCategory(subTitle, subItems, true));
                    });
                }
                
                return section;
            }

            function implementSearch(searchInput) {
                searchInput.addEventListener('input', function() {
                    const filter = this.value.toLowerCase();
                    const links = nav.getElementsByTagName('a');
                    
                    Array.from(links).forEach(link => {
                        const li = link.parentElement;
                        const txtValue = link.textContent || link.innerText;
                        const matches = txtValue.toLowerCase().includes(filter);
                        
                        li.style.display = matches ? '' : 'none';
                        
                        // Show parent categories if child matches
                        let parent = li.parentElement;
                        while (parent && !parent.matches('nav')) {
                            if (matches) {
                                parent.style.display = '';
                                if (parent.classList.contains('collapsed')) {
                                    parent.classList.remove('collapsed');
                                }
                            }
                            parent = parent.parentElement;
                        }
                    });
                });
            }

            fetch('/Topics/pages.json')
                .then(response => response.json())
                .then(data => {
                    Object.entries(data).forEach(([category, items]) => {
                        nav.appendChild(createCategory(category, items));
                    });
                    
                    // Initialize search
                    const searchInput = document.getElementById('sidebar-search');
                    implementSearch(searchInput);
                })
                .catch(error => console.error('Error loading sidebar:', error));
        });
    </script>
</body>
</html>
