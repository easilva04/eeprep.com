<!-- 
  Sidebar Component for EEPrep
  
  Contains:
  - Logo and site title
  - Main navigation links
  - Theme toggle
  - Sidebar collapse functionality
  
  This component is loaded dynamically by componentLoader.js
-->
<div class="sidebar-inner">
    <!-- Sidebar Header: Contains logo, title and close button -->
    <div class="sidebar-header">
        <div class="logo-container">
            <div class="modern-logo">
                <img src="Config/Assets/images/eeprep.png" alt="EE Prep Logo">
            </div>
            <h2 class="sidebar-title">EE Prep</h2>
        </div>
        <button class="sidebar-close hidden-desktop" aria-label="Close menu">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Main Navigation Links -->
    <nav class="sidebar-nav">
        <ul class="sidebar-menu">
            <li class="sidebar-item">
            <a href="index.html" class="sidebar-link" title="Home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            </li>
            <li class="sidebar-item">
            <a href="Topics.html" class="sidebar-link" title="Topics">
                <i class="fas fa-book"></i>
                <span>Topics</span>
            </a>
            </li>
            <li class="sidebar-item">
            <a href="about.html" class="sidebar-link" title="About">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
            </a>
            </li>
            <li class="sidebar-item">
            <a href="contribute.html" class="sidebar-link" title="Contribute">
                <i class="fas fa-users"></i>
                <span>Join Us</span>
            </a>
            </li>
        </ul>
    </nav>
    
    <!-- Sidebar Footer: Contains theme toggle, sidebar toggle and info text -->
    <div class="sidebar-footer">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle Theme">
            <i class="fas fa-moon"></i>
            <span>Toggle Theme</span>
        </button>
        
        <!-- Added sidebar collapse button to the bottom of the sidebar -->
        <button id="sidebar-collapse-toggle" class="sidebar-collapse-toggle" aria-label="Toggle sidebar" title="Collapse Sidebar">
            <i class="fas fa-chevron-left"></i>
            <span>Collapse Sidebar</span>
        </button>
        
        <div class="sidebar-info">
            <small><i>For the aspiring engineer</i></small>
        </div>
    </div>
</div>

<script>
    /**
     * Sidebar functionality script
     * Handles sidebar close button and toggle functionality
     */
    
    // Sidebar close button (mobile)
    const closeButton = document.querySelector('.sidebar-close');
    if (closeButton) {
        closeButton.addEventListener('click', () => {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            if (sidebar) sidebar.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
            document.body.classList.remove('sidebar-open');
            
            // Find and update the mobile toggle button icon
            const mobileToggle = document.querySelector('.mobile-nav-toggle');
            if (mobileToggle && mobileToggle.querySelector('i')) {
                mobileToggle.querySelector('i').className = 'fas fa-bars';
            }
            
            // IMPROVED: Restore body scrolling when sidebar is closed
            document.body.style.overflow = '';
        });
    }
    
    // Sidebar collapse toggle (in footer) - replaces the external toggle button
    const sidebarCollapseToggle = document.getElementById('sidebar-collapse-toggle');
    if (sidebarCollapseToggle) {
        // Update button based on current state
        function updateCollapseToggleButton() {
            const isCollapsed = document.body.classList.contains('sidebar-collapsed');
            const icon = sidebarCollapseToggle.querySelector('i');
            const text = sidebarCollapseToggle.querySelector('span');
            
            if (isCollapsed) {
                icon.className = 'fas fa-chevron-right';
                text.textContent = 'Expand Sidebar';
                sidebarCollapseToggle.setAttribute('title', 'Expand Sidebar');
                sidebarCollapseToggle.setAttribute('aria-label', 'Expand Sidebar');
            } else {
                icon.className = 'fas fa-chevron-left';
                text.textContent = 'Collapse Sidebar';
                sidebarCollapseToggle.setAttribute('title', 'Collapse Sidebar');
                sidebarCollapseToggle.setAttribute('aria-label', 'Collapse Sidebar');
            }
        }
        
        // Initialize button state
        updateCollapseToggleButton();
        
        // Add click handler
        sidebarCollapseToggle.addEventListener('click', () => {
            // Toggle the collapsed state
            document.body.classList.toggle('sidebar-collapsed');
            
            // Update button appearance
            updateCollapseToggleButton();
            
            // Store preference
            localStorage.setItem('sidebar-collapsed', 
                document.body.classList.contains('sidebar-collapsed'));
        });
    }
    
    // IMPROVED: Hide sidebar collapse toggle on mobile
    function updateCollapseToggleVisibility() {
        if (window.innerWidth <= 1024 && sidebarCollapseToggle) {
            sidebarCollapseToggle.style.display = 'none';
        } else if (sidebarCollapseToggle) {
            sidebarCollapseToggle.style.display = 'flex';
        }
    }
    
    // Run on load
    updateCollapseToggleVisibility();
    
    // Run on window resize
    window.addEventListener('resize', updateCollapseToggleVisibility);
    
    // IMPROVED: Mark current page in sidebar
    function highlightCurrentPage() {
        const currentPath = window.location.pathname;
        const links = document.querySelectorAll('.sidebar-link');
        
        links.forEach(link => {
            const href = link.getAttribute('href');
            if (href) {
                // Get the filename part from both URLs
                const currentFile = currentPath.split('/').pop().toLowerCase();
                const linkFile = href.split('/').pop().toLowerCase();
                
                // Mark as active if files match or if we're on homepage
                if (currentFile === linkFile || 
                    (currentFile === '' && linkFile === 'index.html')) {
                    link.parentElement.classList.add('active');
                }
            }
        });
    }
    
    // Run highlight on load
    highlightCurrentPage();
</script>
