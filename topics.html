<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topics - EE Prep</title>
    <link rel="stylesheet" href="Info/Config/Styles/main.css">
    <link rel="stylesheet" href="Info/Config/Styles/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="Info/Config/Scripts/componentLoader.js"></script>
    <script src="Info/Config/Scripts/themeToggle.js"></script>
    <script src="Info/Config/Scripts/search.js"></script>
</head>

<body class="theme-transition">
    <!-- Navigation components will be loaded here -->
    <div id="sidebar-container" class="sidebar"></div>

    <!-- Main content -->
    <main class="main-content">
        <header class="page-header">
            <h1>Topic Categories</h1>
            <div class="breadcrumbs">
                <a href="index.html">Home</a> <i class="fas fa-chevron-right"></i> <span>Topics</span>
            </div>
        </header>

        <div class="content-section">
            <div class="section-header">
                <h2>Choose a Subject Area</h2>
                <p class="section-subtitle">Select a category to see available learning materials</p>
            </div>

            <div id="topics-grid" class="topics-grid">
                <!-- Topics will be loaded dynamically from pages.json -->
                <div class="loading-container">
                    <div class="loading-dots">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                    <p>Loading topics...</p>
                </div>
            </div>
        </div>

        <section class="content-section alt-section">
            <div class="section-header centered">
                <h2>Not Sure Where to Start?</h2>
            </div>
            <div class="content centered">
                <p>If you're new to electrical engineering, we recommend starting with Circuit Analysis basics. If you need to brush up on math first, check out the Mathematics section.</p>
                <div style="margin-top: 2rem;">
                    <a href="./Topics/Circuits/intro.html" class="btn btn-primary">Circuit Fundamentals</a>
                    <a href="./Topics/Math/Math.html" class="btn btn-outline" style="margin-left: 1rem;">Math Review</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer will be loaded here -->
    <div id="footer-container"></div>

    <script>
        // Function to load topics dynamically from pages.json
        document.addEventListener('DOMContentLoaded', function() {
            loadTopics();
        });
        
        function loadTopics() {
            fetch('Topics/pages.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load topics data');
                    }
                    return response.json();
                })
                .then(data => {
                    renderTopics(data);
                })
                .catch(error => {
                    console.error('Error loading topics:', error);
                    document.getElementById('topics-grid').innerHTML = `
                        <div class="error-message">
                            <p>Failed to load topics. Please try again later.</p>
                        </div>
                    `;
                });
        }
        
        function renderTopics(data) {
            const topicsGrid = document.getElementById('topics-grid');
            topicsGrid.innerHTML = '';
            
            // Get all topic categories and sort alphabetically
            const categories = Object.keys(data).sort();
            
            // Define icon mapping for categories
            const iconMap = {
                "Mathematics": "calculator",
                "Circuits": "microchip",
                "Electronics": "wave-square",
                "Digital Systems": "digital-tachograph",
                "Electromagnetics": "bolt",
                "Electrical Materials": "atom",
                "Linear Systems": "compress-arrows-alt",
                "Signal Processing": "exchange-alt",
                "Computer Systems": "laptop-code",
                "Computer Networks": "network-wired",
                "Communications": "broadcast-tower",
                "Control Systems": "sliders-h",
                "Power Systems": "plug",
                "Software Engineering": "code",
                "Engineering Economics": "dollar-sign",
                "Ethics and Professional Practice": "balance-scale",
                // Default icon
                "default": "book"
            };
            
            // Create a card for each category
            categories.forEach(category => {
                // Get the first topic to extract URL and snippet
                const firstTopic = Array.isArray(data[category]) ? 
                    data[category][0] : 
                    Object.values(data[category])[0][0];
                
                // Determine the path for the category home page
                let categoryUrl;
                if (firstTopic && firstTopic.url) {
                    // Extract category URL from the first topic URL
                    // Example: "/Topics/Math/Fundamentals/Math.html" -> "/Topics/Math/Math.html"
                    const urlParts = firstTopic.url.split('/');
                    if (urlParts.length >= 3) {
                        const categoryName = urlParts[2];
                        categoryUrl = `./Topics/${categoryName}/${categoryName}.html`;
                    } else {
                        categoryUrl = firstTopic.url;
                    }
                } else {
                    // Fallback URL based on category name
                    const categoryName = category.replace(/\s+/g, '');
                    categoryUrl = `./Topics/${categoryName}/${categoryName}.html`;
                }
                
                // Get appropriate icon
                const iconClass = iconMap[category] || iconMap.default;
                
                // Create topic card HTML
                const cardHtml = `
                    <div class="topic-card">
                        <div class="topic-icon">
                            <i class="fas fa-${iconClass}"></i>
                        </div>
                        <h3>${category}</h3>
                        <p>${firstTopic?.snippet || `Explore ${category} concepts and applications in electrical engineering.`}</p>
                        <a href="${categoryUrl}" class="btn btn-outline">View Materials</a>
                    </div>
                `;
                
                topicsGrid.innerHTML += cardHtml;
            });
            
            // Add animation to cards
            const cards = document.querySelectorAll('.topic-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 50 * index);
            });
        }
    </script>

    <!-- Register service worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('Info/Config/Scripts/backend.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
